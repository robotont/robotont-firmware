# Firmware architecture

This document contains all the necessary information to begin developing the Robotont firmware. It is divided into specific sections as follows:
<!-- https://github.com/derlin/bitdowntoc -->
- [Firmware architecture](#firmware-architecture)
   * [General overview](#general-overview)
   * [Application layer](#application-layer)
   * [Service layer](#service-layer)
   * [BSP layer](#bsp-layer)
   * [Interface layer](#interface-layer)
   * [MCU HAL and core](#mcu-hal-and-core)
   * [Limitations](#limitations)
   * [Branching strategy (working with git)](#branching-strategy-working-with-git)

## General overview

In this project, the author used a layered architecture approach. The firmware is divided into separate abstraction layers. The higher the layer's position, the less it depends on project-specific hardware.

Firmware design diagram:
<p float="left">
  <img align="top" src=".images/fw_architecture.png" width="600" />
  <img align="top" src=".images/fw_architecture_legend.png" width="200" /> 
</p>

Robotont firmware divided into the five layers:
|Layer|Brief description|
|---|---|
|Application layer|The highest level of abstraction. It defines how various services within Robotont should interact.|
|Service layer|Describes the tasks (or services) a robot should independently perform. Each service must include its own `update` function.|
|BSP layer|Board Support Package layer, also referred to as the Hardware Driver layer. Contains firmware drivers for specific hardware.|
|Interface layer| Wrapper over `STM32F4 HAL` functions. Provides simplified interface to communicate with MCU peripherals. Contains only used peripherals.|
|MCU HAL and core|MCU-specific components that were auto-generated by the `STM32CubeMX` program.|

> [!IMPORTANT]  
> The bottom-level module should never include modules from the top level. This approach will keep the code more portable, not only in terms of MCU and hardware but also in terms of application.

__TODO add repository file tree__

## Application layer

## Service layer

|Component|Description|
|---|---|
|Movement||
|LED control|x|
|OLED control|x|
|Battery monitor|x|
|CMD handler|x|

<!-- (\*) *Exception made for `cmd handler` service. `cmd handler` includes other services. Reason for this approach is that `cmd handler` only purpose is to redirect serial data. Moving this to the application layer will over-complicate the code.* -->

## BSP layer

## Interface layer

## MCU HAL and core

## Limitations

## Branching strategy (working with git)


